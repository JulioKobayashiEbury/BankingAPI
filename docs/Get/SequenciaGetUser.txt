@startuml
title Get User - GET /users/:user_id

actor Requester
boundary UserGetHandler <<userHandler.go>>
control AuthorizeService <<serviceAuthorize.go>>
control GetService <<serviceGetTypes.go>>
entity UserFirestore <<model/user/firestore.go>>

Requester -> UserGetHandler : GET /users/:user_id
activate UserGetHandler

UserGetHandler -> AuthorizeService : Authorize(Cookie)
activate AuthorizeService
AuthorizeService -->> UserGetHandler : Claims (userIDFromClaims) / Error
deactivate AuthorizeService

alt Authorization Failed (or user_id_from_path mismatch with claims.Id)
    UserGetHandler -->> Requester : HTTP Error Response
else Authorization Succeeded
    ' Initialize DBs
    UserGetHandler -> GetService : User(userID_from_path_or_claims)
    activate GetService
    GetService -> UserFirestore : Get(&userID_from_path_or_claims)
    activate UserFirestore
    UserFirestore -->> GetService : userData / Error
    deactivate UserFirestore
    
    alt Get User Failed
        GetService -->> UserGetHandler : Error
        UserGetHandler -->> Requester : HTTP Error Response
    else Get User Succeeded
        GetService -->> UserGetHandler : userResponse
        UserGetHandler -->> Requester : HTTP 200 OK (userResponse)
    end
    deactivate GetService
end
deactivate UserGetHandler
@enduml
@startuml
note top
    Complete Authentication Sequence before following this diagram
end note

participant accountOwner as accountOwner
boundary accountHandler as accountHandler
boundary userHandler as userHandler
control service as service
control repository as repository
entity account as account
entity transfer as transfer
database firestore as firestore

accountOwner -> accountHandler : /accounts/reports
accountHandler -> accountHandler : AccountGetReportHandler

accountHandler -> userHandler : userAuthorization
userHandler -> service : Authorize
service -> userHandler : model.Claims,http.Cookie
userHandler ->  accountHandler : string,model.Erro

accountHandler -> service : GenerateReportByAccount
service -> service : Account
service -> account : Get
account -> repository : GetFireStoreClient
repository -> firestore : NewClient
firestore -> repository : firestore.Client
repository -> account : firestore.Client
account -> firestore : .Collection().Doc().Get()
firestore -> account : firestore.DocumentSnapshot
account -> service : accountResponse

service -> service : GetAllTransfers
service -> transfer : GetAll
transfer -> repository : GetFireStoreClient
repository -> firestore : NewClient
firestore -> repository : firestore.Client
repository -> transfer : firestore.Client
transfer -> firestore : .Collection().Documents()
firestore -> transfer : firestore.DocumentIterator
transfer -> service : []transfer.TransferResponse

service -> service : GetAllAutoDebits
service -> automaticDebit : Get
automaticDebit -> repository : GetFireStoreClient
repository -> firestore : NewClient
firestore -> repository : firestore.Client
repository -> automaticDebit : firestore.Client
automaticDebit -> firestore : .Collection().Documents()
firestore -> automaticDebit : firestore.DocumentIterator
automaticDebit -> service : []automaticdebit.AutomaticDebit

service -> service : GetAllWithdrawals
service -> withdrawal : Get
withdrawal -> repository : GetFireStoreClient
repository -> firestore : NewClient
firestore -> repository : firestore.Client
repository -> withdrawal : firestore.Client
withdrawal -> firestore : .Collection().Documents()
firestore -> withdrawal : firestore.DocumentIterator
withdrawal -> service : []withdrawal.WithdrawalResponse

service -> service : GetAllDeposits
service -> deposits : Get
deposits -> repository : GetFireStoreClient
repository -> firestore : NewClient
firestore -> repository : firestore.Client
repository -> deposits : firestore.Client
deposits -> firestore : .Collection().Documents()
firestore -> deposits : firestore.DocumentIterator
deposits -> service : []deposits.DepositResponse

service -> accountHandler : model.AccountReport
accountHandler -> accountOwner : JSON(http.StatusOK,model.Report)


@enduml
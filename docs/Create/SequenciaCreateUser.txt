@startuml
title Create User - POST /users

actor Requester
boundary UserPostHandler <<userHandler.go>>
control UserService <<serviceUser.go>>
entity UserFirestore <<model/user/firestore.go>>

activate Requester
Requester -> UserPostHandler : POST /users (Body: User Info)
activate UserPostHandler

UserPostHandler -> UserService : CreateUser(userRequest)
activate UserService

alt Missing Credentials (Name, Document, or Password)
    UserService -->> UserPostHandler : Error (Missing credentials)
    UserPostHandler -->> Requester : HTTP Error Response
else
    UserService -> UserFirestore : Create(userRequest)
    activate UserFirestore
    UserFirestore -->> UserService : userID_ptr / Error
    deactivate UserFirestore
    
    alt Create User Record Failed
        UserService -->> UserPostHandler : Error
        UserPostHandler -->> Requester : HTTP Error Response
    else Create User Record Succeeded
        UserService -> UserService : User(*userID_ptr)
        UserService -> UserFirestore : Get(*userID_ptr)
        activate UserFirestore
        UserFirestore -->> UserService : createdUserData / Error
        deactivate UserFirestore
        
        alt Get Created User Failed
            UserService -->> UserService : Error
            UserService -->> UserPostHandler : Error
            UserPostHandler -->> Requester : HTTP Error Response
        else Get Created User Succeeded
            UserService -->> UserService : createdUser
            UserService -->> UserPostHandler : createdUser
            UserPostHandler -->> Requester : HTTP 201 Created (createdUser)
        end
    end
end
deactivate UserService
deactivate UserPostHandler
deactivate Requester
@enduml
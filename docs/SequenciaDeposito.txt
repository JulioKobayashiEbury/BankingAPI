@startuml
note top
    Complete Authentication Sequence before following this diagram
end note

participant accountOwner as accountOwner
boundary accountHandler as accountHandler
boundary userHandler as userHandler
entity account as account
control service as service
control repository as repository
database firestore as firestore

accountOwner -> accountHandler : /accounts/account_id/balance/deposit
accountHandler -> accountHandler : AccountPutDepositHandler
accountHandler -> userHandler : userAuthorization
userHandler -> service : Authorize
service -> userHandler : model.Claims, http.Cookie
userHandler -> accountHandler : string
accountHandler -> service : ProcessDeposit
service -> service : Account
service -> account : Get
account -> repository : GetFireStoreClient
repository -> firestore : NewClient
firestore -> repository : firestore.Client
repository -> account : firestore.Client
account -> firestore : .Collection().Doc().Get()
firestore -> account : firestore.DocumentSnapshot
account -> service : accountResponse

service -> deposit : Create()
deposit -> repository : GetFireStoreClient
repository -> firestore : NewClient
firestore -> repository : firestore.Client
repository -> deposit : firestore.Client
deposit -> firestore : .Collection().Add()


service -> account : AddUpdate()
service -> account : Update()
alt Error
service -> deposit : Delete()
end

service -> accountHandler
alt No errors
accountHandler -> accountOwner : http.StatusAccepted
else Error found
accountHandler -> accountOwner : http.BadRequest
end
@enduml
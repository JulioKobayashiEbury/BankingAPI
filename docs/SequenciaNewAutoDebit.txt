@startuml
note top
    Complete Authentication Sequence before following this diagram
end note

participant accountOwner as accountOwner
boundary accountHandler as accountHandler
entity automaticdebit as automaticdebit
control service as service
control repository as repository
database firestore as firestore

accountOwner -> accountHandler : /accounts/:account_id/debit
accountHandler -> accountHandler : AccountPutAutomaticDebit
accountHandler -> userHandler : userAuthorization
userHandler -> service : Authorize
service -> userHandler : model.Claims,model.Erro,http.Cookie
userHandler ->  accountHandler : string,model.Erro
accountHandler -> service : ProcessNewAutomaticDebit

service -> service : IsValidDate
service -> automaticdebit : Create
automaticdebit -> repository : GetFireStoreClient
repository -> firestore : NewClient
firestore -> repository : firestore.Client
repository -> automaticdebit : firestore.Client
automaticdebit -> firestore : .Collection().Add()
firestore -> automaticdebit : firestore.DocumentRef
automaticdebit -> service
service -> accountHandler :  model.Erro
alt No Error
accountHandler -> accountOwner : http.StatusAccepted
else Error
accountHandler -> accountOwner : http.BadRequest
end

@enduml
@startuml
title Delete User - DELETE /users/:user_id

actor Requester
boundary UserDeleteHandler <<userHandler.go>>
control AuthorizeService <<serviceAuthorize.go>>
control UserService <<serviceDeleteTypes.go>>
entity UserFirestore <<model/user/firestore.go>>

activate Requester 

Requester -> UserDeleteHandler : DELETE /users/:user_id
activate UserDeleteHandler

UserDeleteHandler -> AuthorizeService : Authorize(Cookie)
activate AuthorizeService
AuthorizeService -->> UserDeleteHandler : Claims (userIDFromClaims) / Error
deactivate AuthorizeService

alt Authorization Failed (or user_id mismatch with claims.Id)
    UserDeleteHandler -->> Requester : HTTP Error Response
else Authorization Succeeded
   
    UserDeleteHandler -> UserService : UserDelete(userIDFromClaims_or_path)
    activate UserService
    UserService -> UserFirestore : Delete(&userIDFromClaims_or_path)
    activate UserFirestore
    UserFirestore -->> UserService : nil / Error
    deactivate UserFirestore
    
    alt Delete User Failed
        UserService -->> UserDeleteHandler : Error
        UserDeleteHandler -->> Requester : HTTP Error Response
    else Delete User Succeeded
        UserService -->> UserDeleteHandler : nil
        UserDeleteHandler -->> Requester : HTTP 200 OK (Message: User deleted)
    end
    deactivate UserService
end
deactivate UserDeleteHandler

deactivate Requester
@enduml